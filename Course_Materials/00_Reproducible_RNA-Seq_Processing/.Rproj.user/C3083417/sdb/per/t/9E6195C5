{
    "collab_server" : "",
    "contents" : "---\ntitle: \" RNA-seq analysis \"\noutput: html_notebook\n---\n\n\n# 1. Basic Unix\n\n\nUNIX is an operatig system that was developed in the 1960 and it have been the base of widelly used operative sistems such as Linux and Mac OS. As the data coming out from biological outputs growing exponentially through time, Knowing the unix basics have become essential to do bioinformatics. Here there is a list of the most used commands:\n\n\n|Commad| Use| Examples|  \n|--:|--:|-----:|\n|`cd` | Tove between directories| `cd FASTQ` (to enter a folder)|\n|`cd ..` | To change to the parent of the current directory| |\n|`cd -` | To go to previous directory| |\n|`pwd` | Where am I?| |\n|`ls` | List files | `ls` (on this directory); `ls FASTQ` (list files inside FASTQ) |\n|`mkdir` | make new directory| `mkdir my_folder` |\n|`mv` | move a file or directory| `mv file my_folder/` (move file to a folder) |\n|`cp` | copy file| `cp my_folder/* new_folder/` (copy all files of al folder) |\n|`rm` |Remove a file or folder| `rm file`; `rm -rf folder` |\n|`less` |Displays the contents of a file| `less file.txt` (press `q` to quit) |\n|`head`| Displays the first ten lines of a file | |\n|`tail`| Displays the last ten lines of a file | |\n|`cat` |Print file content|`cat file1 file2 > file.total` (merge files)|\n|`zcat` |Print file content of compresed files|`zcat SRR7889597.fastq.gz` |\n|`gzcat` |mac OSx version of zcat   |`gzcat SRR7889597.fastq.gz` |\n|`wc` | word count | `wc -l file ` (count lines inside of a file)|\n|`grep` | Pattern matching | `grep patern file` (get lines that match the patern)|\n| `cut` | extract columns from files | `cut -f 2 file` (extract second column)\n|`sort` | sort file by column |`sort -nr -k 2 file` (sort file by second column) | \n\n\n**Exercise 1.0.1**\n\nOn the course directory, create a folder named `test_folder` and copy the smallest file inside `FASTQ/` folder. Then change the name of the folder that you just create to `to_delete` and finally remove this folder. \n\n\n## 1.2 Efficient use of the termial \n\n\nTo accelerate our interaction with the terminal, we can use the TAB key:  \n\n![](Images/TAB.png) \n\nFor instance, if you are at course folder and you write `ls Gene_` and then press TAB key once, it will complete the command to `ls Gene_annotation`. But if you just write `ls G` and press TAB two times, it will show you the two options (Gene_annotation and Genome).\n\nAn other powerful thing is to pipe (`|`) the output of one comand into and other command. For exmaple you can do:\n\n`ls FASTQ/*.fastq.gz | wc -l`\n\nTo count all the FASTQ files that are stored at inside of `FASTQ/` folder.\n\nFinally, if you want to now more, every command has its own options, you can see the entire description of a command using `man`. For instance, use man to know more about `head` typing on the command line:\n\n`man head`\n\n**Exercise 1.2.1**\n\nRead the manual of `head` command. Then use it to extract the first 100 lines of `Gene_annotation/dm6.Ensembl.genes.gtf` and count all the lines that has `CDS` at the thrid column. \n\n\n# 2. Input data format\n\n\nIn order to quantify mRNA by RNA-seq analysis, different files are required which as a different format. RNA-Seq reads are normally formatted as [FASTQ](https://en.wikipedia.org/wiki/FASTQ_format), SRA or CRAM. To process this data, the most common initial step is to map the reads to the genome, which is often formatted as [FASTA](https://en.wikipedia.org/wiki/FASTA_format). Finally, to quantify gene expression, we need to know which part of the genome encodes for genes. This information can be found at gene annotation files, which can be formatted as [GTF](http://mblab.wustl.edu/GTF22.html#fields) or [BED](https://genome.ucsc.edu/FAQ/FAQformat.html#format1) files. Explore the different hiperlinks provided for detailed information about the different file formats.\n\n\n## 2.1 FASTA format\n\nFASTA files contain nucleotide or amino acid sequence information. The data is composed of identifiers, which starts with `>` and nucleotide o amino acid sequences. Hundred of thousands of genomes coming from different species are available in public repositories as FASTA files. It is important to notice that a given species can have different genomic assemblies. For instance, a popular assembly human genome assembly is `hg19` that was published in February 2009, and as a huge amount of data is available for that assembly some researchers keep doing their analyses with that version. But other recent analyses have started to use `hg38` instead, which was published in December 2013 and represent a more curated version of the human genome.\n\nFor today's practice, we are going to work with a smaller genome. We already have downloaded for you the `dm6` assembly of D. melanogaster's genome, an invertebrate organism widely used as a model organism for genetic and behavioral studies. The genome file is at course material folder at `Genome/dm6.fa`. \n\n**Exercise 2.1.1**\n\nCount the number of sequences present at `dm6.fa` (hint: count lines that start with `>`, but as this is a special UNIX character, refer to it as `\\>'. Which command can be used for pattern matching and count lines?). \n\nIf each sequence is related to a chromosome, why do we find so many sequences? How many main scaffolds can you see?\n\n**Exercise 2.1.2**\n\nCan you calculate the exact number of nucleotides that this D. melanogaster assembly is made of? (hint: explore additional options of grep and wc)\n\n\n## 2.2 FASTQ format\n\nRNA-seq reads often come as FASTQ, which is an extension of FASTA file format. Every read is represented by four lines:\n\n* First line: start with `@` and correspond to a read identifier. \n* Second line: read nucleotide sequence.\n* Third line: Start with `+` and it can be followed by additional information, but often it is just `+`.\n* Fourth line:  Phred quality score represent the reliability of a base call (as higher the better). It is encoded as ASCII characters. It can have different encodings, such as Sanger, Solexa, Illumina 1.3+ or Illumina 1.8+. Please check [FASTQ format description](https://en.wikipedia.org/wiki/FASTQ_format) for more details.\n\n**Exercise 2.2.1**\n\nWhich of the fastq files found at `FASTQ/` has the highest and the lowest amout of reads? How many reads do they have? What is the read lenght?\n\n\n## 2.3 Gene annotation\n\nEfforts have been made to identify the genomic regions that encode for genes. This information can be stored as BED or GTF files (among other formats). BED files store information about genomic coordinates. Each row of a BED file represents a genomic interval, in the case of gene annotation file, it represents the start and end of a transcript. Exons coordinates are encoded as `blocks`, where the `blockStarts` column is a list of all exon starts relative to the transcript starts and `blockSizes` column contain all the exon sizes. Plase read [BED description format](https://genome.ucsc.edu/FAQ/FAQformat.html#format1) for more information. \n\nGTF files instead are gene-centric annotations, in which a gene can be described by multiple rows. Each row contains the coordinates and additional information of a particular gene feature. Please check the full [GTF description](http://mblab.wustl.edu/GTF22.html)\n\n\n**Exercise 2.3.1**\n\n\nGet D. melanogaster gene annotation files for `dm6` assembly in from [UCSC Table Browser](http://genome-euro.ucsc.edu/cgi-bin/hgTables). Choosing the following values:\n\n* clade: Insect.\n* genome: D. melanogaster.\n* assembly: Aug. 2014 (BDGP Release 6 + ISO1 MT/dm6).\n* group: Gene and Gene Predictions.\n* track: Ensembl Genes.\n* table: ensGene.\n\nAnd get the annotation files as BED and GTF (choosing the right output formats). Save the BED file as `dm6.Ensembl.genes.bed12` and GTF as `dm6.Ensembl.genes.gtf` at `Gene_annotation` folder.\n\n\n**Exercise 2.3.2**\n\nProcess `dm6.Ensembl.genes.bed12` to find the five transcripts with the highest number of exons. \n\n**Exercise 2.3.3**\n\nProcess `dm6.Ensembl.genes.bed12` to find the total number of genes\n\n\n# 3. Quality control before alingment\n\n\n## 3.1 FASTQC\n\n\nTo perform a QC of the Fastq files we can use *FastQC*. We can access to a basic manual of this tool by typing on `fastqc --help` on terminal.\n\n\nLet's create a directory to do a GC analysis of the data\n\n\n**Exercise 3.1.1**\n\nCreate a directory named `QC`. Run `fastqc` for `FASTQ/SRR7889584.fastq.gz` store the resutls at the newly created folder. You will get an html file as output; Open it with a internet browser (Chrome, firefox, etc) and answere the following quesions \n\nA) What is the read leght?\nB) Does the quality score very throught the read lenght?\nC) How is the data quality?\n\n\n\n## 3.2 Metadata analysis on R-studio\n\n\nThe fastq.gz files that we have at `/FASTQ` correspond to RNA-seq data extracted from D. melanogaster brain samples. The data corresponding to a full study published last year on [Cell Reports](https://www.ncbi.nlm.nih.gov//pubmed/30355484) and the full study was published in [SRA archive](https://trace.ncbi.nlm.nih.gov/Traces/sra/?study=SRP162335). \n\n**Exercise 3.2.1**\n\nCheck the [study runs](https://trace.ncbi.nlm.nih.gov/Traces/study/?acc=SRP162335) and compare with the file names from `FASTQ/` folder. Which tissues the samples were extracted from? Select the Runs that correspond to the files that we have and download the `RunInfo Table` corresponding to these tables and save it as `SraRunTable.txt` on the course folder. \n\n**Exercise 3.2.2**\n\nOpen R-studio and open the `Analysis_Notebook.Rmd` file that is located at the course folder. This is an R-notebook file, that has all the code used to generate this document. But, now when you open this file you will be able to run `chunks` of code interactively inside R-studio. Run the following chunk by clicking at the green play button.\n \n\n```{r}\n\nlibrary(data.table)\n\nmetadata <- fread(\"./SraRunTable.txt\") #Please be sure to place the file under ./Course_Materials/00_Reproducible_RNA-SEQ_Initial_Processing/\n\nmetadata\n```\n\n\nBy running this code, we imported the metadata as a data.table object, which correspond to a very convenient structure to manipulate data in R. For more information visit this [link](https://www.datacamp.com/community/tutorials/data-table-cheat-sheet). We can now easily manipulate the data! For example, we can filter the metadata rows, so we only see the ones corresponding to \"central neurons\"\n\n\n\n```{r}\nmetadata[source_name==\"central neurons\" , ]\n```\n\n\nWe can also get explore if we have a lowly sequenced sample filtering by the `MBases` values\n\n```{r}\nmetadata[MBases < 100 , ]\n```\n\n\nOr get the average Mega bases across this sample\n\n```{r}\n\nmetadata[  , mean(MBases) ]\n\n```\n\n\nTo explore this visualy, we can plot with ggplot2. This is one of the most popular packages to visualize data. A basic code to visualize the Mbases distribution can be run as:\n\n```{r}\nlibrary(ggplot2)\n\nggplot(data = metadata) +  # Frist layer - Data input\n  geom_bar(aes(x=Run, y=MBases), stat = \"identity\")   # second layer - type of plot and axis\n\n```\n\n\nWe can rotate the text to make it more visible\n\n```{r}\n\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, ), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))  # Third layer -  visual configuration\n\n```\n\n\n\n\ninside `aes( )` are the variables and we can also define a variable as the colour:\n\n\n```{r}\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, colour=source_name), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))\n```\n\nBut for this particular type of graph, filling the bar with one colour is more suitable\n\n```{r}\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, fill=source_name), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))\n```\n\n\n\nFrom this plot, we can clearly see that one of the samples that were taken from central neurons is much smaller than the rest. This factor needs to be considered at the time we analyze the samples, as this poorly sequenced sample might have lead to less accurate mRNA quantification and it might need to be removed for quantitative analyses. \n\n\n\n# 4. Mapping reads to the genome\n\n\n\n\nAfter we have a diagnosis of the data quality, we can start to analyse the data. Usually the first step into the analysis requires mapping the RNA-seq reads to the genome. There are nomerous tools to do perform short read aligment and the choice of it shoud be carefolly made accordint ot the analysis goals and requirements. Hisat2 is a very fastq tool that have been shown to have a good performace on published benchmars. \n\nTo start mapping RNA-seq reads to the genome, we need to index the genome. The command to do this is `hisat2-build`. \n\n\n## 4.1 Indexing the genome for Hisat2\n\n\n```{bash}\nhisat2-build --help\n```\n\n\nOn the comand-line execute (you need to be at the Course_materials folder)\n\n```{bash}\n\nhisat2-build -p 5 Genome/dm6.fa Genome/Index/dm6\n\n```\n\n\nThis command will use the genome (located at `Genome/dm6.fa`) and it will generate the index files on `Genome/Index/`. All the files will start with `dm6` prefix\n\n\n## 4.2 Runing hisat2\n\n\nTo map the reads to the genome we need to run hisat2. Take a quick look to hisat2's description\n\n```{bash}\nhisat2 --help\n\n```\n\n**Exercise 4.2.1**\n\nRun hista2 for the smallest file, SRR7889582.fastq, located at FASTQ folder using 5 proccesors. Save the results inside a folder named `hisat2` (create it with mkdir), under the file name of hisat2/SRR7889582.sam\nhint: Use -p -U -x -S flags\n\n\n# 5. Quality control after alingment\n\n\n# 6. Gene quantification\n\n\n## 7.1 Bigwig files\n\n## 7.2 Bigwig files\n\n# 8. Workflow mannager\n\n\n\n----------------------------Day two-------------------------------------------\n\n\n\n\n\n# Genomebrowser visualization\n\n\n# Transcriptome Assembly\n\n\n# 9. Aligment-free quantification (Salmon)\n\n```{r}\n#<img src=\"Images/TAB.png\" width=\"100\" style=\"float\": \"right\"> \n```\n\n\n\n\n\n\n\n\n\n\n\n\n-----------------------OLD FILE------------------------------------\n\n\n\n\n\n\n\n```{r}\nlibrary(data.table)\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(RUVSeq)\nlibrary(RColorBrewer)\n\n```\n\n\n# Indroduction\n\n\n\nThe objetive of this session is to learn the essential bioinformatics concepts of RNA-seq analysis. We are goint to use high-performace data analysis tools to process data comming from fruit fly brains. The data have been recently published on [SRA](https://trace.ncbi.nlm.nih.gov/Traces/sra/?study=SRP162335) and aparently the paper have not been out yet, therefore any conclusion we do with this data can be a new discovery. EXCITING! Due to time restrictions, we only are going to work with samples corresponding to glia and neurons. These are the two principal brain componets. The questions that we are going to try to answere during this practical are:\n  1.- Is the data good quality ?\n  2.- Can we detect gene expression profile difrences beteween glia and neurons?\n  3.- Can we detect alternative splicing paters specific to neurons or glial cells?\n\n\n# Experiment desing and basic R commands\n\n\nFirst we are going to inspect the study Medadata. In order to load it in to this R session, you can use the following command\n\n\n\n```{r}\n\nmetadata <- data.table(read_delim(\"SraRunTable.txt\", \"\\t\", escape_double = FALSE, trim_ws = TRUE))\n\n```\n\n\nWe imported the metadata as a data.table object, which correspond to a very convenient structure to manipulate data in R. For more information visit this [link](https://www.datacamp.com/community/tutorials/data-table-cheat-sheet). For example, we can filter the metadata rows, so we only see the ones corresponding to \"central neurons\"\n\n\n\n```{r}\nmetadata[source_name==\"central neurons\" , ]\n```\n\n\nWe can also get explore if we have a lowly sequenced sample filtering by the `MBases` values\n\n```{r}\nmetadata[MBases < 100 , ]\n```\n\n\nOr get the average Mega bases across this sample\n\n```{r}\n\nmetadata[  , mean(MBases) ]\n\n```\n\n\nTo explore this visualy, we can plot with ggplot2. This is one of the most popular packages to visualize data. A basic code to visualize the Mbases distribution can be run as:\n\n```{r}\nggplot(data = metadata) +  # Frist layer - Data input\n  geom_bar(aes(x=Run, y=MBases), stat = \"identity\")   # second layer - type of plot and axis\n\n```\n\n\nWe can rotate the text to make it more visible\n\n```{r}\n\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, ), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))  # Third layer -  visual configuration\n\n```\n\n\nIn this case, we are using the `geom_bar` function. Do `?geom_bar` to have ore information about this function\n\n\n```{r}\n?geom_bar\n```\n\n\ninside `aes( )` are the variables and we can also define a variable as the colour:\n\n\n```{r}\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, colour=source_name), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))\n```\n\nBut for this particular type of graph, filling the bar with one colour is more suitable\n\n```{r}\nggplot(data=metadata) +\n  geom_bar(aes(x=Run, y=MBases, fill=source_name), stat = \"identity\") + \n  theme(axis.text.x = element_text(angle = 45))\n```\n\n\n### Beginer's challenge\n\nDo the same type of plot than above, but use `MBytes` instead. \n\n\n\n\n# Quality Control (QC)\n\n\nTo perform a QC of the Fastq files we can use *FastQC*. We can access to a basic manual of this tool by typing on `fastqc --help` on terminal, or by runing the next *bash* chunck\n\n\n```{bash}\n\nfastqc --help\n\n```\n\n\nLet's create a directory to do a GC analysis of the data\n\n\n```{bash}\n\nmkdir QC\n\n```\n\n\n### Challenge\n\nRun fastqc for `FASTQ/SRR7889584.fastq.gz` and store the resutls at the newly created folder.\nOpen the obtained html output with a internet browser (Chrome, firefox, etc)\n\n### Questions\n\nWhat is the read leght?\nDoes the quality score very throught the read lenght?\nHow is the data quality?\n\n\n\n\n# Mapping read to the genome\n\n\n\nAfter we have a diagnosis of the data quality, we can start to analyse the data. Usually the first step into the analysis requires mapping the RNA-seq reads to the genome. There are nomerous tools to do perform short read aligment and the choice of it shoud be carefolly made accordint ot the analysis goals and requirements. Hisat2 is a very fastq tool that have been shown to have a good performace on published benchmars. \n\nTo start mapping RNA-seq reads to the genome, we need to index the genome. The command to do this is `hisat2-build`. \n\n\n## Genome indexing \n\n\n```{bash}\nhisat2-build --help\n```\n\n\nOn the comand-line execute (you need to be at the Course_materials folder)\n\n```{bash}\n\nhisat2-build -p 5 Genome/dm6.fa Genome/Index/dm6\n\n```\n\n\nThis command will use the genome (located at `Genome/dm6.fa`) and it will generate the index files on `Genome/Index/`. All the files will start with `dm6` prefix\n\n\n## Mapping reads to the genome\n\n\nTo map the reads to the genome we need to run hisat2. Take a quick look to hisat2's description\n\n```{bash}\nhisat2 --help\n\n```\n\n### Challegne\n\nRun hista2 for the smallest file, SRR7889582.fastq, located at FASTQ folder using 5 proccesors. Save the results inside a folder named `hisat2` (create it with mkdir), under the file name of hisat2/SRR7889582.sam\nhint: Use -p -U -x -S flags\n\n\n# Lets RUN them all!!!!\n\nWe have a master script called 'snakemake'. Go to the course_material directory on the comand-line and run:\n\n\n```{bash}\n\n#Reduce the number of cores if your machine does not have this many available \n\nsnakemake featureCounts/TOTAL.gene_count.txt --cores 7\n\n```\n\n\nThis script will paralelize all the processes for the other files and it will generate a gene count file (`featureCounts/TOTAL.gene_count.txt`) which is the output of featureCounts. We will explain this on more detail.\n\n# Diferential expression analysis\n\n\nThere are serveral methods to perform differential gene expression analysis. Today we are going to use Deseq2, one of the most widely used methods for assessing changes on gene expression. The first step is to import the output of *featureCounts* as *data.table* object. \n\n\n### Challenge\n\n\nUse the *Import Dataset* button at the top-right corner and select *from CSV*. Use de *Browse* button to get to the file path. Look for the `TOTAL.gene_count.txt` file inside `featureCounts` folder. Use `#` as Quotes and select the appropriated delimiter. Make sure than the preview looks like a table and then clic import. \n\n\n\n```{r}\n\n### Solution ###\n\n\nTOTAL_gene_count <- read_delim(\"featureCounts/TOTAL.gene_count.txt\", \n    \"\\t\", escape_double = FALSE, comment = \"#\", \n    trim_ws = TRUE)\n\n\n\n```\n\n\nNow we have the featureCount's output as an object in R, we can visualize it on the cell bellow.\n\n\n```{r}\nTOTAL_gene_count\n```\n\n###Questions\n\nWhy do we have repeated values for `Chr` and `Start`?\nHow many genes do we have in the analysis? hint: use `dim()` or `nrow()`\n\n\n## Data exploration\n\nTo continue with the analysis we first need to adapt the format of our *gene count matrix*. The following code will generate an data.table object called `cts`. This format will allow us to run Deseq2, one of the most widely used programs to perform differential gene expression analyses. For more information read Deseq2 [manual](https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html). Part of the downstream code were based on \"Count matrix input\" and \"Differential expression analysis\" sections.\n\n```{r}\n\nTOTAL_gene_count <- data.frame(TOTAL_gene_count) \n\ncts <- TOTAL_gene_count[ ,7:ncol(TOTAL_gene_count)]\ncolnames(cts) <- substring(names(cts), 8,17)\nrownames(cts) <- TOTAL_gene_count$Geneid\n\ncoldata <- data.frame( condition = metadata$source_name, row.names = metadata$Run )\n\ncts <- cts[, rownames(coldata)]\n```\n\n###Question\n\nWhat are the differences between `TOTAL_gene_count` and `cts`?\nWhat kind of information does `coldata` contain? Why do we need that to perform differential gene expression analysis?\n\n\n\n## Principal component analysis\n\n\nWe are going to use principal compoent analysis (PCA) to have an overview of the sample differeces. If you are not familiar with PCA and you have headphones, you can watch this [video](\"https://www.youtube.com/watch?v=HMOI_lkzW08\"). For making the PCA, we are going to use a function of the `RUVSeq` package ; `plotPCA`,  which requires us to store our data on a `newSeqExpressionSet` object. Do not worry if you don't understand the code, let just focus on the output plot for now ! \n\n\n```{r}\n\n\n\ncolors <- brewer.pal(3, \"Set2\")\nset <- newSeqExpressionSet(as.matrix(cts),\n                             phenoData = coldata )\nplotPCA(set, col=colors[coldata$condition], cex=1.2)  \n\n```\n\n\n### Questions\n\nWhat is the main conclusion of our PCA? \nDo we have consistent differences on gene expression profiles in between glia and neurons?\nWhat does PC1 represents?\nWhich cell type has more transcriptional variability?\n\n\n## Running Deseq2 \n\n\nTo run `Deseq2` we nee to store our gene expresion data on a `DESeqDataSetFromMatrix` object. \n\n```{r}\nlibrary(DESeq2)\n\ndds <- DESeqDataSetFromMatrix(countData = cts,\n                              colData = coldata,\n                              design = ~ condition)\n\n```\n\n\nWe are now ready to run Deseq2!\n\n```{r}\ndds <- DESeq(dds)\n```\n\nThe `dds` object store many different type of output infromation. To extract the main result table, we need to use `results()` fucntion. Then we can convert the output table into a data.table object, which is convenient to futher data exploration.\n\n```{r}\nres <- results(dds)\nrestable <- data.frame(res)\nrestable$GeneID <- rownames(restable)\nrestable <- data.table(restable)\nrestable\n```\n\n### Question\n\nWhy do we have missing values?\n\n## Signigicant genes\n\nUsing the function `order()` we can sort genes by their corrected pvalue (`padj`)\n\n```{r}\nrestable[order(padj)]\n\n```\n\nThe genes with smaller `padj` trend to have biger differences (`log2FoldChange`). We can define as significant the genes that `padj>0.05`. We can define a new column (`sig`) to classify by this criterium. \n\n\n```{r}\nrestable <- restable[!is.na(padj), ]   # Removing missing p-values (when there are not enough counts, padj cannot be estimated)\n\nrestable[ padj<0.05 , sig:=TRUE ]\nrestable[ padj>0.05 , sig:=FALSE ]\n```\n\n\nIn order to see the results, we can do a *vulcano plot*, which correspond to log2FoldChange vs -log(padj). To see if our significant criterium is acceptable, we are going to colour significant genes on red. \n\n```{r}\n\n\n\nggplot(data=restable) +\n  geom_point(aes(x=log2FoldChange, y=-log(padj), colour=sig ))\n```\n\nOoops! By default, ggplot2 plot FALSE as red.   \nTIP: To actually plot the significant genes in red, we need to swap the factors\n\n\n\n```{r}\n\n\nrestable$sig <- factor(restable$sig , levels = c(TRUE, FALSE) ) # swapping factors\n\nggplot(data=restable) +\n  geom_point(aes(x=log2FoldChange, y=-log(padj), colour=sig ))\n```\n\n\n```{r}\nrestable\n```\n\n\nBut, eventhough some genes has a significant padj, only genes with a big absulute log2FoldChange will be biologically meaningful. Thus, we should redifine our significanse condition to be limmited only to genes which has an absolute log2FoldChange value greater than 1. \n\n### Challenge \n\nA) Re-define `sig` column to match our new criterium. How many significant genes do we have under this criterium? generate the vulcano plot\nHint: use `padj<0.05 & abs(log2FoldChange)>=1` as new condition and generate. \n\nB) Generate an MA plot ( x=log2(baseMean) ; y=log2FoldChange).Does the signidicant genes distribute uniformely across x-axis? \n\n\n```{r}\n\n### Solution  ##\n\nggplot(data=restable) +\n  geom_point(aes(x=log2(baseMean), y=log2FoldChange, colour=sig ))\n\n```\n\n\n###  Bonus Challenge! \n\n(leave this for the end)\nRe-do the analysis but exclude the sample with fewer reads. Low depth samples might interfere with the analysis. \n\n\n\n\n\n\n\n\n\n\nSys.setenv(PATH='/Users/gp7/miniconda2/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/Library/TeX/texbin:/usr/local/munki:/opt/X11/bin:/usr/local/git/bin')",
    "created" : 1553461257875.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4076695516",
    "id" : "9E6195C5",
    "lastKnownWriteTime" : 1553463049,
    "last_content_update" : 1553463049736,
    "path" : "~/@Github/RNAseq_March_2019/Course_Materials/00_Reprodusible_RNA-SEQ_Intial_Processing/00_Reprodusible_RNA-Seq_Initial_Processing.Rmd",
    "project_path" : "00_Reprodusible_RNA-Seq_Initial_Processing.Rmd",
    "properties" : {
        "chunk_output_type" : "inline"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}